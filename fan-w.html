<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FanCode Live (JW Player)</title>

  <!-- JW Player -->
  <script src="https://cdn.jwplayer.com/libraries/aVr2lJgW.js"></script>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body { background: #0c0e12; color: #e2e8f0; font-family: Inter, sans-serif; }
    #player { border: 1px solid #1f2937; box-shadow: 0 4px 10px rgba(0,0,0,0.5); border-radius: 12px; }
    .switch-btn {
      @apply w-40 h-16 flex items-center justify-center bg-gray-800 text-lg font-bold rounded-xl shadow-lg transition-all duration-200;
    }
    .switch-btn:hover { @apply bg-blue-600 scale-105; }
    .switch-btn.active { @apply ring-4 ring-blue-400 bg-blue-700; }
    .url-input-container { @apply flex items-center justify-center p-2 rounded-lg bg-gray-800 border border-gray-700 w-full max-w-lg; }
    .url-input { @apply bg-transparent text-sm w-full outline-none truncate; }
    .copy-btn { @apply ml-2 p-2 rounded-lg bg-blue-600 hover:bg-blue-700 transition-colors; }
  </style>
</head>
<body class="flex flex-col items-center min-h-screen p-4 md:p-8">

  <h1 id="matchTitle" class="text-3xl font-bold text-blue-400 mb-6 text-center tracking-wide">
    Loading...
  </h1>

  <div id="player" class="w-full max-w-4xl rounded-xl overflow-hidden shadow-2xl"></div>

  <div class="mt-8 flex gap-6 flex-wrap justify-center">
    <button id="mainBtn" class="switch-btn">Main</button>
    <button id="backupBtn" class="switch-btn">Backup</button>
  </div>

  <div class="mt-8 url-input-container">
    <input type="text" id="currentUrlInput" class="url-input" readonly placeholder="Current Stream URL">
    <button id="copyUrlBtn" class="copy-btn">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
        <path d="M8 2a2 2 0 00-2 2v2a2 2 0 002 2h4a2 2 0 002-2V4a2 2 0 00-2-2H8zM6 4a4 4 0 014-4h4a4 4 0 014 4v2a4 4 0 01-4 4h-4a4 4 0 01-4-4V4zM4 14a2 2 0 00-2 2v2a2 2 0 002 2h4a2 2 0 002-2v-2a2 2 0 00-2-2H4z" />
      </svg>
    </button>
  </div>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const matchId = urlParams.get("id");
    const apiUrl = "https://raw.githubusercontent.com/jitendra-unatti/fancode/refs/heads/main/data/fancode.m3u";

    let jwplayerInstance = null;
    let streamUrls = [];
    let currentUrl = "";

    async function loadM3U() {
      try {
        const res = await fetch(apiUrl);
        if (!res.ok) throw new Error(`Fetch failed: ${res.status}`);
        const text = await res.text();

        // Parse M3U lines
        const lines = text.split("\n").map(l => l.trim()).filter(Boolean);
        let currentInfo = null;

        for (let line of lines) {
          if (line.startsWith("#EXTINF")) {
            const tvgIdMatch = line.match(/tvg-id="([^"]+)"/);
            const logoMatch = line.match(/tvg-logo="([^"]+)"/);
            const titleMatch = line.split(",").pop();
            currentInfo = {
              id: tvgIdMatch ? tvgIdMatch[1] : null,
              logo: logoMatch ? logoMatch[1] : null,
              title: titleMatch || "Unknown",
              urls: []
            };
          } else if (currentInfo && line.startsWith("http")) {
            currentInfo.urls.push(line);
            streamUrls.push(currentInfo);
            currentInfo = null;
          }
        }

        const match = streamUrls.find(m => m.id == matchId);
        if (!match) {
          document.getElementById("matchTitle").textContent = "Match not found!";
          return;
        }

        document.getElementById("matchTitle").textContent = match.title;

        const mainUrl = match.urls[0] || "";
        const backupUrl = match.urls[1] || "";

        if (!mainUrl && !backupUrl) {
          document.getElementById("matchTitle").textContent = "No stream found!";
          return;
        }

        // Initialize JW Player
        currentUrl = mainUrl;
        jwplayerInstance = jwplayer("player").setup({
          file: currentUrl,
          type: "hls",
          width: "100%",
          aspectratio: "16:9",
          autostart: true,
          controls: true,
          logo: match.logo ? { file: match.logo, position: "top-left" } : undefined
        });

        highlightButton("mainBtn");
        updateUrlInput(currentUrl);

        // Bind buttons
        document.getElementById("mainBtn").onclick = () => switchSource(mainUrl, "mainBtn");
        document.getElementById("backupBtn").onclick = () => switchSource(backupUrl, "backupBtn");

        if (!backupUrl) document.getElementById("backupBtn").disabled = true;

      } catch (err) {
        console.error("Error loading M3U:", err);
        document.getElementById("matchTitle").textContent = "Error loading stream.";
      }
    }

    function highlightButton(id) {
      document.querySelectorAll('.switch-btn').forEach(btn => btn.classList.remove('active'));
      document.getElementById(id).classList.add('active');
    }

    function updateUrlInput(url) {
      document.getElementById('currentUrlInput').value = url;
    }

    function switchSource(url, btnId) {
      if (!url || !jwplayerInstance) return;
      currentUrl = url;
      jwplayerInstance.load([{ file: url, type: "hls" }]);
      jwplayerInstance.play();
      highlightButton(btnId);
      updateUrlInput(url);
    }

    document.getElementById("copyUrlBtn").addEventListener("click", async () => {
      try {
        await navigator.clipboard.writeText(currentUrl);
        alert("URL copied!");
      } catch {
        alert("Failed to copy.");
      }
    });

    loadM3U();
  </script>
</body>
  </html>
  
