<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Watch Match - FanCode</title>
<script src="https://cdn.jwplayer.com/libraries/aVr2lJgW.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  body { background: #0f172a; color: #f8fafc; font-family: sans-serif; }
  .btn-toggle { transition: background 0.3s; }
  .btn-toggle:hover { background: #2563eb; color: white; }
</style>
</head>
<body class="flex flex-col items-center p-4">

<header class="text-center mb-4">
  <h1 class="text-2xl font-bold text-blue-400">ðŸ“º FanCode Streaming</h1>
</header>

<!-- JWPlayer Container -->
<div id="jwplayer-container" class="w-full max-w-3xl"></div>

<h2 id="matchTitle" class="mt-4 text-center text-lg font-semibold"></h2>
<div id="info" class="mt-2 text-center text-sm text-gray-400"></div>

<!-- Stream Switch Buttons -->
<div class="mt-4 flex gap-2">
  <button id="btnDai" class="btn-toggle px-4 py-2 bg-gray-700 rounded font-semibold">DAI Stream</button>
  <button id="btnAdfree" class="btn-toggle px-4 py-2 bg-gray-700 rounded font-semibold">AdFree Stream</button>
</div>

<script>
const API_URL = "https://raw.githubusercontent.com/drmlive/fancode-live-events/refs/heads/main/fancode.json";
const PROXY_URL = "https://mini.allinonereborn.online/sony/stream_proxy.php?url=";
const urlParams = new URLSearchParams(window.location.search);
const matchId = urlParams.get("id");

let jwPlayerInstance;
let matchData;

async function loadMatch() {
  try {
    const res = await fetch(API_URL);
    const data = await res.json();
    matchData = data.matches.find(m => m.match_id == matchId);

    if(!matchData) {
      document.body.innerHTML = "<p class='text-red-500 text-lg'>Match not found!</p>";
      return;
    }

    document.getElementById("matchTitle").innerText = matchData.title;
    document.getElementById("info").innerHTML = `
      ${matchData.team_1} ðŸ†š ${matchData.team_2} | ${matchData.event_name} | Status: 
      <span class="${matchData.status==='LIVE'?'text-red-400':'text-blue-400'} font-semibold">${matchData.status}</span>
    `;

    const initialUrl = matchData.adfree_url || matchData.dai_url;
    jwPlayerInstance = jwplayer("jwplayer-container");
    jwPlayerInstance.setup({
      file: PROXY_URL + encodeURIComponent(initialUrl),
      width: "100%",
      aspectratio: "16:9",
      autostart: true,
      controls: true,
      primary: "html5",
    });
  } catch(e) {
    console.error("Error loading match:", e);
  }
}

// Switch Streams via Proxy
document.getElementById("btnDai").addEventListener("click", () => {
  if(matchData?.dai_url) {
    jwPlayerInstance.load([{ file: PROXY_URL + encodeURIComponent(matchData.dai_url) }]);
  }
});

document.getElementById("btnAdfree").addEventListener("click", () => {
  if(matchData?.adfree_url) {
    jwPlayerInstance.load([{ file: PROXY_URL + encodeURIComponent(matchData.adfree_url) }]);
  }
});

loadMatch();
</script>
</body>
</html>
