<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hanime Video Player</title>
<link href="https://vjs.zencdn.net/8.6.1/video.min.css" rel="stylesheet">
<script src="https://vjs.zencdn.net/8.6.1/video.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/videojs-contrib-hls@5.15.0/dist/videojs-contrib-hls.min.js"></script>
<style>
  body { margin: 0; background: #000; color: #fff; font-family: Arial, sans-serif; display: flex; flex-direction: column; height: 100vh; }
  #player { width: 100%; flex: 1; }
  .storyboards { display: flex; overflow-x: auto; padding: 10px; background: #111; }
  .storyboards img { margin-right: 5px; height: 90px; cursor: pointer; transition: transform 0.2s; }
  .storyboards img:hover { transform: scale(1.1); }
</style>
</head>
<body>

<video id="player" class="video-js vjs-default-skin" controls preload="auto" playsinline></video>
<div class="storyboards" id="storyboards"></div>

<script>
async function fetchVideoStreams(slug) {
  const res = await fetch(`https://hanime.tv/api/v8/video?id=${slug}`);
  const data = await res.json();
  const streams = data.videos_manifest.servers[0].streams
    .filter(s => s.url)
    .map(s => ({ src: s.url, type: "application/x-mpegURL", label: `${s.height}p` }));
  return { streams, videoId: data.hentai_video.id };
}

async function fetchStoryboards(videoId) {
  const res = await fetch(`https://hanime.tv/rapi/v7/hentai_video_storyboards?hv_id=${videoId}`);
  const data = await res.json();
  return data.hentai_video_storyboards[0];
}

async function initPlayer() {
  const slug = location.hash.slice(1);
  if (!slug) { alert("No video slug found!"); return; }

  const { streams, videoId } = await fetchVideoStreams(slug);
  const storyboardData = await fetchStoryboards(videoId);

  // Initialize Video.js
  const player = videojs('player', {
    fluid: true,
    autoplay: false,
    controls: true,
    preload: 'auto',
    sources: streams
  });

  // Storyboard thumbnails
  const container = document.getElementById("storyboards");
  const totalFrames = storyboardData.num_total_frames;
  const frameWidth = storyboardData.frame_width;
  const frameHeight = storyboardData.frame_height;

  for (let i = 0; i < totalFrames; i++) {
    const img = document.createElement("img");
    img.src = storyboardData.url;
    img.width = frameWidth;
    img.height = frameHeight;
    img.onclick = () => {
      const duration = player.duration() || 0;
      player.currentTime((i / totalFrames) * duration);
    };
    container.appendChild(img);
  }
}

window.addEventListener("hashchange", initPlayer);
initPlayer();
</script>

</body>
</html>
